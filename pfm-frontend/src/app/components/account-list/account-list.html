<div class="flex">
  <app-sidebar></app-sidebar>
  <div class="flex-1 min-h-screen bg-[#424042] py-6 ml-5 sm:ml-40 md:ml-56 lg:ml-64">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="bg-gradient-to-r from-[#4a3a6e] to-[#2a292a] rounded-lg shadow-lg mb-8 p-6 border border-[#3d3c3d]">
        <h1 class="text-3xl font-bold text-white mb-2">Accounts</h1>
        <p class="text-purple-200">Overview of all accounts</p>
      </div>

      @if (loading) {
        <div class="bg-[#363536] rounded-lg shadow-sm p-8 text-center border border-[#2a292a]">
          <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-[#7c5cf6] mx-auto mb-4"></div>
          <p class="text-gray-300">Loading accounts...</p>
        </div>
      }

      @if (error) {
        <div class="bg-red-900/20 rounded-lg p-4 mb-6 border border-red-900/30">
          <div class="flex items-center">
            <svg class="w-5 h-5 text-red-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <span class="text-red-300 font-medium">Failed to load accounts</span>
          </div>
        </div>
      }

      @if (!loading && !error) {
        @if (isAdmin()) {
          <div class="mb-6 text-right">
            <button (click)="openCreateAccountForm()"
                    class="px-4 py-2 rounded-lg text-white shadow bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700">New Account</button>
          </div>
        }
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
          @for (account of pagedAccounts?.items || []; track account.id) {
            <div class="relative group">
              <div class="relative rounded-xl border border-[#3d3c3d] bg-gradient-to-br from-[#2a292a] to-[#1f1e1f] p-6 shadow-md transition-all duration-300 group-hover:shadow-2xl group-hover:-translate-y-1 flex flex-col">
                <div class="flex items-center justify-between mb-4">
                  <div>
                    <div class="text-xl font-bold text-white">{{account.accountNumber}}</div>
                    <div class="text-sm text-gray-400">{{account.userFullName}}</div>
                  </div>
                  <svg class="w-8 h-8 text-purple-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15A2.25 2.25 0 0 0 2.25 6.75v10.5A2.25 2.25 0 0 0 4.5 19.5Z" />
                  </svg>
                </div>
                <div class="space-y-3 text-sm">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center text-gray-400">
                      <svg class="w-5 h-5 mr-2 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .5968.237 1.1691.659 1.591l9.5811 9.5811a2.25 2.25 0 003.0684.1734 48.823 48.823 0 004.224-4.224 2.25 2.25 0 00-.1734-3.0684L11.159 3.65901A2.25 2.25 0 009.568 3z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z"/>
                      </svg>
                      <span>Type</span>
                    </div>
                    <span class="px-2 py-0.5 rounded bg-indigo-600/20 text-indigo-300">{{account.accountType}}</span>
                  </div>
                  <div class="flex items-center justify-between">
                    <div class="flex items-center text-gray-400">
                      <svg class="w-5 h-5 mr-2 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6V18M9 15.1818L9.87887 15.841C11.0504 16.7197 12.9498 16.7197 14.1214 15.841C15.2929 14.9623 15.2929 13.5377 14.1214 12.659C13.5355 12.2196 12.7677 12 11.9999 12C11.275 12 10.5502 11.7804 9.99709 11.341C8.891 10.4623 8.891 9.03772 9.9971 8.15904C11.1032 7.28036 12.8965 7.28036 14.0026 8.15904L14.4175 8.48863M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z"/>
                      </svg>
                      <span>Currency</span>
                    </div>
                    <span class="px-2 py-0.5 rounded bg-emerald-600/20 text-emerald-300">{{account.currency}}</span>
                  </div>
                  <div class="flex items-center justify-between">
                    <div class="flex items-center text-gray-400">
                      <svg class="w-5 h-5 mr-2 text-sky-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 12C21 10.7574 19.9926 9.75 18.75 9.75H15C15 11.4069 13.6569 12.75 12 12.75C10.3431 12.75 9 11.4069 9 9.75H5.25C4.00736 9.75 3 10.7574 3 12M21 12V18C21 19.2426 19.9926 20.25 18.75 20.25H5.25C4.00736 20.25 3 19.2426 3 18V12M21 12V9M3 12V9M21 9C21 7.75736 19.9926 6.75 18.75 6.75H5.25C4.00736 6.75 3 7.75736 3 9M21 9V6C21 4.75736 19.9926 3.75 18.75 3.75H5.25C4.00736 3.75 3 4.75736 3 6V9"/>
                      </svg>
                      <span>Available</span>
                    </div>
                    <span class="text-white">{{formatAmount(account.availableAmount)}}</span>
                  </div>
                  <div class="flex items-center justify-between">
                    <div class="flex items-center text-gray-400">
                      <svg class="w-5 h-5 mr-2 text-red-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75C16.5 4.26472 14.4853 2.25 12 2.25C9.51472 2.25 7.5 4.26472 7.5 6.75V10.5M6.75 21.75H17.25C18.4926 21.75 19.5 20.7426 19.5 19.5V12.75C19.5 11.5074 18.4926 10.5 17.25 10.5H6.75C5.50736 10.5 4.5 11.5074 4.5 12.75V19.5C4.5 20.7426 5.50736 21.75 6.75 21.75Z"/>
                      </svg>
                      <span>Reserved</span>
                    </div>
                    <span class="text-white">{{formatAmount(account.reservedAmount)}}</span>
                  </div>
                </div>
                <div class="mt-4">
                  <div class="h-2 bg-[#3d3c3d] rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-purple-500 to-pink-500" [style.width.%]="getReservedPercent(account)"></div>
                  </div>
                  <div class="mt-1 text-xs text-gray-400 text-right">{{getReservedPercent(account)}}% reserved</div>
                </div>
                <div class="mt-6 pt-4 border-t border-[#3d3c3d] flex justify-end">
                  @if (isAdmin() && account.isActive) {
                    <button (click)="deactivate(account.id)" class="px-3 py-1 bg-red-600 text-white rounded-lg hover:bg-red-700">Deactivate</button>
                  } @else {
                    <span class="inline-flex items-center px-2 py-0.5 rounded text-sm font-medium border bg-red-900 text-red-300 border-red-700">Inactive</span>
                  }
                </div>
              </div>
            </div>
          }
        </div>
      }

      @if (pagedAccounts && pagedAccounts.totalPages > 1) {
        <div class="flex justify-center mt-8">
          <nav class="flex items-center space-x-2">
            <!-- Previous Button -->
            <button (click)="previousPage()"
                    [disabled]="currentPage <= 1"
                    [ngClass]="{
                      'bg-[#2a292a] text-gray-400 cursor-not-allowed': currentPage <= 1,
                      'bg-[#2a292a] text-white hover:bg-[#4a3a6e] border-[#2a292a]': currentPage > 1
                    }"
                    class="px-3 py-2 border rounded-lg text-sm font-medium transition-colors duration-200">
              <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"/>
              </svg>
            </button>

            <!-- Page Numbers -->
            @for (page of getVisiblePages(); track page) {
              @if (page === -1) {
                <span class="px-3 py-2 text-gray-400">...</span>
              } @else {
                <button (click)="goToPage(page)"
                        [ngClass]="{
                          'bg-[#4a3a6e] text-white border-[#4a3a6e]': page === currentPage,
                          'bg-[#2a292a] text-white hover:bg-[#4a3a6e] border-[#2a292a]': page !== currentPage
                        }"
                        class="px-4 py-2 border rounded-lg text-sm font-medium transition-colors duration-200">
                  {{page}}
                </button>
              }
            }

            <!-- Next Button -->
            <button (click)="nextPage()"
                    [disabled]="pagedAccounts && currentPage >= pagedAccounts.totalPages"
                    [ngClass]="{
                      'bg-[#2a292a] text-gray-400 cursor-not-allowed': pagedAccounts && currentPage >= pagedAccounts.totalPages,
                      'bg-[#2a292a] text-white hover:bg-[#4a3a6e] border-[#2a292a]': pagedAccounts && currentPage < pagedAccounts.totalPages
                    }"
                    class="px-3 py-2 border rounded-lg text-sm font-medium transition-colors duration-200">
              <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
              </svg>
            </button>
          </nav>
        </div>
      }
    </div>
  </div>
</div>
